#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
    Manage script
    ~~~~~~~~~~~~~

    Copyright 2016 bb8 Authors
"""

from __future__ import print_function

import os
import sys

from flask_script import Server, Manager

from bb8 import config, app
from bb8.api import request

from bb8.commands import shell
from bb8.commands import database

bb8_root = os.path.normpath(os.path.join(os.path.dirname(__file__), '..'))
context = (
    os.path.join(bb8_root, 'certs/cert.pem'),
    os.path.join(bb8_root, 'certs/key.pem')
)

server = Server(host='0.0.0.0', port=config.PORT, ssl_context=context)

manager = Manager(app)
manager.add_command('runserver', server)

shell.install_commands(manager)
database.install_commands(manager)


if __name__ == "__main__":
    # Warn user about operating on a production database
    if 'deploy' in config.DATABASE:
        print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
        print('!                         WARNING                         !')
        print('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!')
        print('\nYou are about to operate on the PRODUCTION database!!')
        print('Do you still want to continue? [yes/No] ', end='')

        if raw_input() != 'yes':
            sys.exit(1)

    config.COMMIT_ON_APP_TEARDOWN = False
    manager.run()
