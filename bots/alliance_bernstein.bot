{
  "bot": {
    "name": "Alliance Bernstein",
    "description": "Alliance Bernstein Fund Bot",
    "interaction_timeout": 120,
    "admin_interaction_timeout": 10,
    "session_timeout": 0,
    "ga_id": "UA-46363590-11",
    "settings": {
      "get_start_button": {"message": {"text": "Hi"}},
      "persistent_menu": [
        {
          "type": "web_url",
          "title": "Compose.ai 官方網站",
          "url": "http://compose.ai"
        }
      ]
    },
    "nodes": {
      "Start": {
        "name": "First time user",
        "description": "First time user",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.router.core.noop",
          "config": {
            "next_node_id": "RootRouter"
          }
        }
      },

      "Root": {
        "name": "Root",
        "description": "Root node, show usage",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "text": "嗨 {{user.first_name}} ! ☺"
              }
            ]
          }
        }
      },

      "RootRouter": {
        "name": "RootRouter",
        "description": "Root router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["2018OF"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "歡迎參與2018聯博全球投資論壇，請點選此網址 https://pigeonhole.at/2018OF，與講者進行即時互動"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["測驗結果說明"],
                  "memory_set": [
                    {"key": "ajax_root", "value": "{{memory.ajax_root|unref('') if memory.ajax_root else 'http://dotted-lexicon-133523.appspot.com'}}"}
                  ]
                },
                "end_node_id": "GetReasons",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救", "求助"]
                },
                "end_node_id": "ShowHelp",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["查詢(.+)", "搜尋(.+)", "關鍵字(.+)"],
                  "collect_as": {"key": "FEATURE", "value": "KeywordQuery"},
                  "memory_set": [
                    {"key": "FEATURE", "value": "KeywordQuery"},
                    {"key": "keyword", "value": "{{matches#1}}"},
                    {"key": "ajax_root", "value": "{{memory.ajax_root|unref('') if memory.ajax_root else 'http://dotted-lexicon-133523.appspot.com'}}"}
                  ]
                },
                "end_node_id": "KeywordQuery",
                "ack_message": "使用關鍵字查詢中..."
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["測驗","投資靈感製造機"]
                },
                "end_node_id": "StartGame",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["開始"],
                  "collect_as": {"key": "FEATURE", "value": "NoIdea"},
                  "memory_set": [
                    {"key": "FEATURE", "value": "NoIdea"},
                    {"key": "ajax_root", "value": "{{memory.ajax_root|unref('') if memory.ajax_root else 'http://dotted-lexicon-133523.appspot.com'}}"}
                  ]
                },
                "end_node_id": "RecommendFunds",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["不滿意"],
                  "collect_as": {"key": "FEATURE", "value": "Category"},
                  "memory_set": [
                    {"key": "FEATURE", "value": "Category"},
                    {"key": "ajax_root", "value": "{{memory.ajax_root|unref('') if memory.ajax_root else 'http://dotted-lexicon-133523.appspot.com'}}"}
                  ]
                },
                "end_node_id": "NotSatisfied",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["債券型", "股票型", "多元資產"],
                  "collect_as": {"key": "FEATURE", "value": "ListCategory"},
                  "memory_set": [
                    {"key": "FEATURE", "value": "ListCategory"},
                    {"key": "category"},
                    {"key": "ajax_root", "value": "{{memory.ajax_root|unref('') if memory.ajax_root else 'http://dotted-lexicon-133523.appspot.com'}}"}
                  ]
                },
                "end_node_id": "ListCategory",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)prod"],
                  "memory_set": [
                    {"key": "ajax_root", "value": "http://dotted-lexicon-133523.appspot.com"}
                  ]
                },
                "end_node_id": "Root",
                "ack_message": "Switched to PROD: {{memory.ajax_root}}"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)dev"],
                  "memory_set": [
                    {"key": "ajax_root", "value": "http://localhost:8888"}
                  ]
                },
                "end_node_id": "Root",
                "ack_message": "Switched to DEV: {{memory.ajax_root}}"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["滿意"]
                },
                "end_node_id": "Satisfy",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "sticker",
                  "params": [".*"]
                },
                "end_node_id": "StartGame",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["AB", "ab", "tttt"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "謝謝您的關注\n今天想了解何種投資訊息？\n輸入下列數字，一秒立即回覆 􀐂􀇲pencil􏿿 \n[1] 債券\n[2] 股票\n[3] 多元資產\n[4] 配息試算\n[5] 查詢配息資訊\n[6] 查詢休市日期\n[7] 查詢最新淨值"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^1$", "bond"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "關於債券，您應該要知道的3件事\n\n立即點閱，讓收益投資管家為您解答 􀐂􀇲pencil􏿿\n\n+ 淺談債券基金 https://goo.gl/LKMaiC\n+ 債券基金與配息率 https://goo.gl/QmxuLx\n+ 債券基金種類與風險 https://goo.gl/f7QyVL\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^2$"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "關於股票，您應該要知道的3件事\n\n立即點閱，讓收益投資管家為您解答 􀐂􀇲pencil􏿿\n\n+ 參考指數和報酬率的關係 https://goo.gl/z108Br\n+ 股價怎樣看才算合理 https://goo.gl/3GxQ64\n+ 評估企業獲利很重要 https://goo.gl/stmzNy\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^3$"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "多元資產之所以稱做「多元」，是因為投資範圍不只是股票、債券等傳統單一資產，更涵蓋了其他資產和策略，才能創造出廣泛的收益來源。\n\n看更多↘https://goo.gl/xzEQZd\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^4$"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "手機滑一滑，算算每月期望現金流 􀄃􀄹eighthnote􏿿\n\n馬上算↘https://goo.gl/MHSkQD\n\n最新配息資訊 : https://goo.gl/Mi6UjP\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^5$", "配息", "配息基準日"]
                },
                "end_node_id": "Node5",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^6$", "休市日", "休市日期"]
                },
                "end_node_id": "Node6",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^7$", "淨值"]
                },
                "end_node_id": "RootRouter",
                "ack_message": "最新基金淨值馬上看 :  https://goo.gl/eBke8o\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["^qr$"]
                },
                "end_node_id": "QRCode",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["退休"]
                },
                "end_node_id": "Retire",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "OnError",
              "ack_message": ""
            }
          }
        }
      },

      "OnError": {
        "name": "OnError",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "text": "謝謝您的留言! 此為自動回覆訊息，我們無法進行個別對談 􀄃􀆏moon wink􏿿\n歡迎您致電聯博 (02)8758-3888 􀐂􀅉smartphone􏿿 服務時間：09:00-18:00\n\n最新淨值 https://goo.gl/eBke8o\n基金配息 https://goo.gl/Cqn5Bl"
              },
              {
                "text": "投資透視 https://goo.gl/nqjQW1\n基金績效 https://goo.gl/iI2pCN\n影音專區 https://goo.gl/NiE0QS\n我的關注基金 https://goo.gl/RQQ4ZC\n\n或輸入AB，可了解更多投資訊息喔! 􀐂􀇲pencil􏿿"
              }
            ]
          }
        }
      },

      "Retire": {
        "module": {
          "config": {
            "messages": [
              {
                "text": "還在煩惱年金怎麼計算? 勞退夠不夠養老嗎?\n\n聯博用一張圖，讓你秒懂退休金如何規劃 https://goo.gl/Vsxbrv"
              }
            ]
          },
          "id": "ai.compose.content.core.message"
        },
        "next_node_id": "RootRouter",
        "name": "Retire",
        "expect_input": false,
        "description": "Retire"
      },

      "Node5": {
        "name": "Node5",
        "expect_input": false,
        "description": "Node5",
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "imagemap",
                    "imagemap_url": "http://i.imgur.com/Ix9DAmk.jpg",
                    "actions": [
                      {
                        "type": "web_url",
                        "url": "https://www.abfunds.com.tw/apac/tw/mobile/funds/views/dividend.htm",
                        "area": {
                          "x": 0,
                          "y": 0,
                          "width": 1040,
                          "height": 1040
                        }
                      }
                    ]
                  }
                }
              },
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "imagemap",
                    "imagemap_url": "http://i.imgur.com/SN857px.jpg",
                    "actions": [
                      {
                        "type": "web_url",
                        "url": "https://www.abfunds.com.tw/apac/tw/mobile/funds/views/dividend.htm",
                        "area": {
                          "x": 0,
                          "y": 0,
                          "width": 1040,
                          "height": 1040
                        }
                      }
                    ]
                  }
                }
              },
              {
                "text": "聯博最新配息紀錄 : https://goo.gl/Mi6UjP\n\n想回上一頁，請輸入AB  􀄃􀄳ok􏿿"
              }
            ]
          }
        }
      },

      "Node6": {
        "module": {
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "image",
                  "payload": {
                    "url": "http://i.imgur.com/yRLGU2j.jpg"
                  }
                }
              },
              {
                "attachment": {
                  "type": "image",
                  "payload": {
                    "url": "http://i.imgur.com/hvyQ8Jc.jpg"
                  }
                }
              }
            ]
          },
          "id": "ai.compose.content.core.message"
        },
        "next_node_id": "RootRouter",
        "name": "Node6",
        "expect_input": false,
        "description": "Node6"
      },

      "QRCode": {
        "module": {
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "image",
                  "payload": {
                    "url": "http://i.imgur.com/pDzDnUB.png"
                  }
                }
              }
            ]
          },
          "id": "ai.compose.content.core.message"
        },
        "next_node_id": "RootRouter",
        "name": "QRCode",
        "expect_input": false,
        "description": "QRCode"
      },

      "DoNothing": {
        "name": "DoNothing",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.noop",
          "config": {}
        }
      },

      "ShowHelp": {
        "name": "ShowHelp",
        "description": "Show help",
        "expect_input": false,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "text": "「測驗」可以找到適合你的投資策略。"
              },
              {
                "text": "「查詢+關鍵字」可以搜尋基金。例如：「查詢新興市場」"
              }
            ]
          }
        }
      },

      "StartGame": {
        "name": "StartGame",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "text": "Hi {{user.first_name}} ! ☺"
              },
              {
                "text": "接下來測驗純屬趣味，不代表任何投資建議、顧問或銷售。"
              },
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "我們會從你喜不喜歡以下5個名人，並依據你的回答推測你可能會喜歡的投資策略，準備好開始了嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "開始測驗",
                        "payload": "開始"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },

      "RecommendFunds": {
        "name": "RecommendFunds",
        "description": "RecommendFunds",
        "expect_input": false,
        "next_node_id": "Questionaire0",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=NextFoodsToChoose",
            "params": [
              ["hl", "zh_TW"],
              ["input", "[]"],
              ["timezone", "{{user.timezone}}"],
              ["platform_user_ident", "{{user.platform_user_ident}}"]
            ],
            "transform": [
              {
                "type": "jinja",
                "template": [
                  "{",
                  "  \"memory\": {",
                  "    \"Questionaire0\": \"{{transform_input[0].food}}\",",
                  "    \"Questionaire1\": \"{{transform_input[1].food}}\",",
                  "    \"Questionaire2\": \"{{transform_input[2].food}}\",",
                  "    \"Questionaire3\": \"{{transform_input[3].food}}\",",
                  "    \"Questionaire4\": \"{{transform_input[4].food}}\"",
                  "  }",
                  "}"
                ]
              }
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。"
          }
        }
      },

      "Questionaire0": {
        "name": "Questionaire0",
        "description": "Questionaire0",
        "expect_input": false,
        "next_node_id": "Questionaire0Router",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "你喜歡{{memory.Questionaire0}}嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      "Questionaire0Router": {
        "name": "Questionaire0Router",
        "description": "Questionaire0Router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"],
                  "memory_set": [
                    {"key": "Answer0", "value": "-{{memory.Questionaire0}}"},
                    {"key": "Answers", "value": "-"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire1"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"],
                  "memory_set": [
                    {"key": "Answer0", "value": "+{{memory.Questionaire0}}"},
                    {"key": "Answers", "value": "+"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire1"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "Questionaire0",
              "ack_message": ""
            }
          }
        }
      },

      "Questionaire1": {
        "name": "Questionaire1",
        "description": "Questionaire1",
        "expect_input": false,
        "next_node_id": "Questionaire1Router",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "你喜歡{{memory.Questionaire1}}嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      "Questionaire1Router": {
        "name": "Questionaire1Router",
        "description": "Questionaire1Router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"],
                  "memory_set": [
                    {"key": "Answer1", "value": "-{{memory.Questionaire1}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}-"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire2"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"],
                  "memory_set": [
                    {"key": "Answer1", "value": "+{{memory.Questionaire1}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}+"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire2"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "Questionaire1",
              "ack_message": ""
            }
          }
        }
      },

      "Questionaire2": {
        "name": "Questionaire2",
        "description": "Questionaire2",
        "expect_input": false,
        "next_node_id": "Questionaire2Router",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "你喜歡{{memory.Questionaire2}}嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      "Questionaire2Router": {
        "name": "Questionaire2Router",
        "description": "Questionaire2Router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"],
                  "memory_set": [
                    {"key": "Answer2", "value": "-{{memory.Questionaire2}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}-"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire3"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"],
                  "memory_set": [
                    {"key": "Answer2", "value": "+{{memory.Questionaire2}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}+"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire3"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "Questionaire2",
              "ack_message": ""
            }
          }
        }
      },

      "Questionaire3": {
        "name": "Questionaire3",
        "description": "Questionaire3",
        "expect_input": false,
        "next_node_id": "Questionaire3Router",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "你喜歡{{memory.Questionaire3}}嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      "Questionaire3Router": {
        "name": "Questionaire3Router",
        "description": "Questionaire3Router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"],
                  "memory_set": [
                    {"key": "Answer3", "value": "-{{memory.Questionaire3}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}-"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire4"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"],
                  "memory_set": [
                    {"key": "Answer3", "value": "+{{memory.Questionaire3}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}+"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "Questionaire4"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "Questionaire3",
              "ack_message": ""
            }
          }
        }
      },

      "Questionaire4": {
        "name": "Questionaire4",
        "description": "Questionaire4",
        "expect_input": false,
        "next_node_id": "Questionaire4Router",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "你喜歡{{memory.Questionaire4}}嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      "Questionaire4Router": {
        "name": "Questionaire4Router",
        "description": "Questionaire4Router",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"],
                  "collect_as": {"key": "NoIdeaQuestionaires", "value": "[\"{{memory.Answer0}}\", \"{{memory.Answer1}}\", \"{{memory.Answer2}}\", \"{{memory.Answer3}}\", \"-{{memory.Questionaire4}}\"]"},
                  "memory_set": [
                    {"key": "Answer4", "value": "-{{memory.Questionaire4}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}-"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "UpdateDietHabit"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"],
                  "collect_as": {"key": "NoIdeaQuestionaires", "value": "[\"{{memory.Answer0}}\", \"{{memory.Answer1}}\", \"{{memory.Answer2}}\", \"{{memory.Answer3}}\", \"+{{memory.Questionaire4}}\"]"},
                  "memory_set": [
                    {"key": "Answer4", "value": "+{{memory.Questionaire4}}"},
                    {"key": "Answers", "value": "{{memory.Answers}}+"}
                  ]
                },
                "ack_message": "",
                "end_node_id": "UpdateDietHabit"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "Questionaire4",
              "ack_message": ""
            }
          }
        }
      },

      "UpdateDietHabit": {
        "name": "UpdateDietHabit",
        "description": "UpdateDietHabit",
        "expect_input": false,
        "next_node_id": "{{'ShowCategory' if memory.Answers == '-----' else 'GetPreference'}}",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=RecordSelectedFoods",
            "params": [
              ["user_lang", "zh_TW"],
              ["selected", "[\"{{memory.Answer0}}\", \"{{memory.Answer1}}\", \"{{memory.Answer2}}\", \"{{memory.Answer3}}\", \"{{memory.Answer4}}\"]"],
              ["platform_user_ident", "{{user.platform_user_ident}}"]
            ],
            "transform": [
              {
                "type": "jinja",
                "template": [
                  "{",
                  "}"
                ]
              }
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。 (Update)"
          }
        }
      },

      "GetPreference": {
        "name": "GetPreference",
        "description": "GetPreference",
        "expect_input": false,
        "next_node_id": "ComposeAiGetRecommendedFoods",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=GetPreference",
            "params": [
              ["platform_user_ident", "{{user.platform_user_ident}}"],
              ["timezone", "{{user.timezone}}"]
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。(GetPreference)"
          }
        }
      },

      "ComposeAiGetRecommendedFoods": {
        "name": "ComposeAiGetRecommendedFoods",
        "description": "ComposeAiGetRecommendedFoods",
        "expect_input": false,
        "next_node_id": "ComposeAiGetRecommendedFoodsNext",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=GetRecommendedFoods",
            "params": [
              ["user_lang", "zh_TW"],
              ["selected", "[\"{{memory.Answer0}}\", \"{{memory.Answer1}}\", \"{{memory.Answer2}}\", \"{{memory.Answer3}}\", \"{{memory.Answer4}}\"]"]
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。"
          }
        }
      },

      "GetReasons": {
        "name": "GetReasons",
        "description": "GetReasons",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=GetReasons",
            "params": [
              ["user_lang", "zh_TW"],
              ["selected", "[\"{{memory.Answer0}}\", \"{{memory.Answer1}}\", \"{{memory.Answer2}}\", \"{{memory.Answer3}}\", \"{{memory.Answer4}}\"]"]
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。(GetReasons)"
          }
        }
      },

      "ComposeAiGetRecommendedFoodsNext": {
        "name": "ComposeAiGetRecommendedFoodsNext",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "滿意這個測驗結果嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "滿意",
                        "payload": "滿意"
                      },
                      {
                        "type": "postback",
                        "title": "不滿意",
                        "payload": "不滿意"
                      },
                      {
                        "type": "postback",
                        "title": "測驗結果說明",
                        "payload": "測驗結果說明"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },

      "KeywordQuery": {
        "name": "KeywordQuery",
        "description": "KeywordQuery",
        "expect_input": false,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=KeywordQuery",
            "params": [
              ["user_lang", "zh_TW"],
              ["keyword", "{{memory.keyword}}"]
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。"
          }
        }
      },

      "NotSatisfied": {
        "name": "NotSatisfied",
        "description": "NotSatisfied",
        "expect_input": false,
        "next_node_id": "ShowCategory",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "text": "{{user.first_name}} 我欣賞你對投資很有想法!"
              },
              {
                "text": "👍 "
              }
            ]
          }
        }
      },

      "ShowCategory": {
        "name": "ShowCategory",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "請問你喜歡哪一類型的投資策略呢？",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "股票型",
                        "payload": "股票型"
                      },
                      {
                        "type": "postback",
                        "title": "債券型",
                        "payload": "債券型"
                      },
                      {
                        "type": "postback",
                        "title": "多元資產",
                        "payload": "多元資產"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },

      "ListCategory": {
        "name": "ListCategory",
        "description": "ListCategory",
        "expect_input": false,
        "next_node_id": "ListCategoryGoodOrNot",
        "module": {
          "id": "ai.compose.content.core.commando",
          "config": {
            "url": "{{memory.ajax_root}}/want_ajax?action=ListCategory",
            "params": [
              ["category", "{{memory.category}}"]
            ],
            "debug": false,
            "on_error": "我好像壞掉了，快通知管理員。(ListCategory)"
          }
        }
      },

      "ListCategoryGoodOrNot": {
        "name": "ListCategoryGoodOrNot",
        "expect_input": false,
        "next_node_id": "ListCategoryGoodOrNotRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": [
              {
                "attachment": {
                  "type": "template",
                  "payload": {
                    "template_type": "button",
                    "text": "喜歡這些投資策略嗎?",
                    "buttons": [
                      {
                        "type": "postback",
                        "title": "喜歡",
                        "payload": "喜歡"
                      },
                      {
                        "type": "postback",
                        "title": "不喜歡",
                        "payload": "不喜歡"
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },

      "ListCategoryGoodOrNotRouter": {
        "name": "ListCategoryGoodOrNotRouter",
        "description": "ListCategoryGoodOrNotRouter",
        "expect_input": true,
        "next_node_id": "Root",
        "module": {
          "id": "ai.compose.router.core.default",
          "config": {
            "links": [
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(使用)?說明", "tutorial", "^\\?", "(?i)help", "幫助", "怎麼用?", "^？", "不會用", "求救"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(no)", "不好", "不喜歡", "不是", "不喜"]
                },
                "ack_message": "",
                "end_node_id": "ShowCategory"
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(yes|ok)", "好", "喜歡", "是"]
                },
                "end_node_id": "Satisfy",
                "ack_message": ""
              },
              {
                "rule": {
                  "type": "regexp",
                  "params": ["(?i)(hi|hello)", "你好", "主選單", "哈囉"]
                },
                "end_node_id": "Root",
                "ack_message": ""
              }
            ],
            "on_error": {
              "end_node_id": "ListCategoryGoodOrNot",
              "ack_message": ""
            }
          }
        }
      },

      "Satisfy": {
        "name": "Satisfy",
        "expect_input": false,
        "next_node_id": "RootRouter",
        "module": {
          "id": "ai.compose.content.core.message",
          "config": {
            "messages": {
              "Facebook": [
                {
                  "text": "謝謝你"
                },
                {
                  "text": "😜       "
                },
                {
                  "attachment": {
                    "type": "template",
                    "payload": {
                      "template_type": "generic",
                      "elements": [
                        {
                          "title": "或許你的好友也會想玩玩看，接下來長按下面這則訊息 ↓↓，選擇選單中的「轉傳」，就可以分享給你的好朋友喔 :D",
                          "buttons": [
                            {
                              "type": "element_share"
                            }
                          ]
                        }
                      ]
                    }
                  }
                },
                {
                  "text": "推薦你玩玩「投資靈感製造機 」，先按此連結與我成為LINE 好友吧~「https://line.me/R/ti/p/%40gpt0697p」"
                },
                {
                  "attachment": {
                    "type": "template",
                    "payload": {
                      "template_type": "button",
                      "text": "想再玩一次嗎？",
                      "buttons": [
                        {
                          "type": "postback",
                          "title": "是",
                          "payload": "測驗"
                        }
                      ]
                    }
                  }
                }
              ],
              "Line": [
                {
                  "text": "謝謝你"
                },
                {
                  "text": "😜       "
                },
                {
                  "text": "或許你的好友也會想玩玩看，接下來長按下面這則訊息 ↓↓，選擇選單中的「轉傳」，就可以分享給你的好朋友喔 :D"
                },
                {
                  "text": "推薦你玩玩「投資靈感製造機 」，先按此連結與我成為LINE 好友吧~「https://line.me/R/ti/p/%40gpt0697p」"
                },
                {
                  "attachment": {
                    "type": "template",
                    "payload": {
                      "template_type": "button",
                      "text": "想再玩一次嗎？",
                      "buttons": [
                        {
                          "type": "postback",
                          "title": "是",
                          "payload": "測驗"
                        }
                      ]
                    }
                  }
                }
              ]
            }
          }
        }
      }
    }
  }
}
